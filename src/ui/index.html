<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>wsh $</title>
</head>
<body>
    <h1><code id="query"></code></h1>
    <pre id="output"></pre>

    <script>
        let state = `{{state}}`
        let queryElement = document.getElementById('query')
        let outputElement = document.getElementById('output')

        queryElement.innerText = `wsh $ ${state.query || ''}`

        if (state.socketId != null) {
            let socket = new WebSocket(window.location.toString().replace(/^https?:/, 'ws:'))

            document.title = `wsh $ ${state.args[0] || ''}`

            socket.onopen = () => {
                socket.send(state.socketId)
            }

            socket.onmessage = evt => {
                outputElement.innerText += evt.data.toString()
            }
        } else {
            outputElement.innerText = state.output
        }
    </script>
</body>
</html>
